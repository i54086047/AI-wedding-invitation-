<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title id="docTitle">建立你的電子喜帖</title>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0b0f;
      --card: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.92);
      --dim: rgba(255,255,255,0.70);
      --accent:#c9a27d;
      --accent-dark:#a07c56;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Noto Sans TC", system-ui, -apple-system, sans-serif;
      background:
        radial-gradient(circle at 15% 10%, rgba(201,162,125,0.12), transparent 45%),
        radial-gradient(circle at 80% 0%, rgba(255,255,255,0.06), transparent 40%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    a{ color: inherit; }
    .wrap{
      width: min(980px, 100%);
      margin: 0 auto;
      padding: 22px 16px 64px;
    }

    /* Header */
    .header{
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      margin-bottom: 14px;
    }
    h1{
      font-size: 22px;
      margin:0;
      letter-spacing: .02em;
    }
    .sub{
      margin-top:8px;
      color: var(--dim);
      font-size: 13px;
      line-height: 1.6;
    }
    .tag{
      font-size: 12px;
      color: rgba(255,255,255,0.75);
      border: 1px solid rgba(255,255,255,0.14);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      white-space: nowrap;
    }

    /* Language toggle (buttons, no dropdown) */
    .langbar{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .langbtn{
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.9);
      padding: 8px 12px;
      border-radius: 999px;
      cursor:pointer;
      font-size: 12px;
      transition: transform .18s ease, border-color .18s ease, background .18s ease;
      user-select:none;
    }
    .langbtn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,0.28); }
    .langbtn.active{
      background: rgba(201,162,125,0.18);
      border-color: rgba(201,162,125,0.55);
    }

    /* Pages (4 pages: Q1/Q2/Q3/Form) */
    .page{
      display:none;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .32s ease, transform .32s ease;
    }
    .page.active{
      display:block;
    }
    .page.visible{
      opacity: 1;
      transform: translateY(0);
    }

    /* Question page layout */
    .qstage{
      margin-top: 14px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 18px;
      min-height: 520px;
      display:flex;
      flex-direction:column;
    }
    .qtop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .step{
      font-size: 12px;
      color: rgba(255,255,255,0.75);
      border: 1px solid rgba(255,255,255,0.14);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      white-space: nowrap;
    }
    .qcenter{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px 0 10px;
    }
    .qbox{
      width: min(740px, 100%);
      text-align:center;
    }
    .qlabel{
      font-size: 18px;
      line-height: 1.45;
      letter-spacing: .01em;
      margin: 0 0 12px;
    }
    textarea, input{
      width:100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.25);
      color: var(--text);
      outline: none;
    }
    textarea{
      min-height: 160px;
      resize: vertical;
    }
    input::placeholder, textarea::placeholder{ color: rgba(255,255,255,0.45); }

    .hint{
      margin-top: 10px;
      color: rgba(255,255,255,0.60);
      font-size: 12px;
      line-height: 1.6;
      text-align:left;
    }

    /* Actions */
    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content: center;
      margin-top: 8px;
      padding-bottom: 6px;
    }
    .btn{
      border:none;
      cursor:pointer;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 13px;
      color: #fff;
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
      user-select:none;
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      white-space: nowrap;
    }
    .btn-primary{
      background: var(--accent);
      box-shadow: var(--shadow);
    }
    .btn-primary:hover{ background: var(--accent-dark); transform: translateY(-1px); }
    .btn-ghost{
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.18);
    }
    .btn-ghost:hover{ border-color: rgba(255,255,255,0.35); transform: translateY(-1px); }
    .btn-danger{
      background: rgba(255,120,120,0.18);
      border: 1px solid rgba(255,120,120,0.35);
    }
    .btn-danger:hover{
      background: rgba(255,120,120,0.26);
      transform: translateY(-1px);
    }

    .status{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,255,255,0.75);
      text-align:center;
      min-height: 18px;
    }
    .error{ color: #ffb4b4; }
    .ok{ color: #bfffd6; }

    /* Form page card */
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      margin-top: 14px;
      backdrop-filter: blur(10px);
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 760px){
      .grid{ grid-template-columns: 1fr; }
      .qstage{ min-height: 520px; }
      .qlabel{ font-size: 16px; }
      textarea{ min-height: 170px; }
    }
    label{
      display:block;
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      margin: 0 0 6px;
      text-align:left;
    }
    .divider{
      height:1px;
      background: rgba(255,255,255,0.10);
      margin: 14px 0;
    }
    .section-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .section-title h2{
      margin:0;
      font-size: 15px;
      letter-spacing:.02em;
    }

    /* Uploader */
    .uploader{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 760px){
      .uploader{ grid-template-columns: 1fr; }
    }
    .upload-box{
      border: 1px dashed rgba(255,255,255,0.22);
      border-radius: 14px;
      padding: 12px;
      background: rgba(0,0,0,0.18);
    }
    .upload-box .top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .upload-box .name{
      font-weight: 600;
      font-size: 13px;
    }
    .upload-box small{
      display:block;
      margin-top: 6px;
      color: rgba(255,255,255,0.55);
      line-height: 1.5;
    }

    /* Generating overlay (random short sentences) */
    .overlay{
      position: fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(10px);
      z-index: 9999;
      padding: 24px;
    }
    .overlay.show{ display:flex; }
    .overlay-card{
      width: min(720px, 100%);
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(10,10,14,0.62);
      box-shadow: 0 20px 60px rgba(0,0,0,0.45);
      padding: 22px;
      text-align:center;
    }
    .spinner{
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: 3px solid rgba(255,255,255,0.14);
      border-top-color: rgba(201,162,125,0.85);
      margin: 0 auto 14px;
      animation: spin 0.95s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
    .gen-title{
      font-size: 16px;
      margin: 0 0 8px;
      letter-spacing: .02em;
    }
    .gen-line{
      font-size: 13px;
      color: rgba(255,255,255,0.78);
      line-height: 1.7;
      min-height: 50px;
      transition: opacity .22s ease;
    }
    .gen-sub{
      margin-top: 12px;
      font-size: 12px;
      color: rgba(255,255,255,0.60);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div>
        <h1 id="h1Title">建立你的電子喜帖</h1>
        <div class="sub" id="subTitle">
          先回答 3 題（逐題翻頁），AI 會幫你把文案填進表格。最後再上傳 4 張背景照片生成「四頁翻頁」模板。<br/>
          建議照片用橫式、解析度至少 1600px 寬（手機原圖通常 OK）。
        </div>

        <!-- language toggle buttons -->
        <div class="langbar" role="tablist" aria-label="Language">
          <button class="langbtn active" data-lang="zh" type="button">繁中</button>
          <button class="langbtn" data-lang="en" type="button">EN</button>
          <button class="langbtn" data-lang="ko" type="button">한국어</button>
          <button class="langbtn" data-lang="vi" type="button">Tiếng Việt</button>
        </div>
      </div>
      <span class="tag" id="mvpTag">四頁流程 MVP</span>
    </div>

    <!-- Page 1: Q1 -->
    <section class="page active visible" id="page-q1">
      <div class="qstage">
        <div class="qtop">
          <span class="tag" id="qaTag">AI 問答</span>
          <span class="step" id="step1">Step 1 / 4</span>
        </div>

        <div class="qcenter">
          <div class="qbox">
            <p class="qlabel" id="q1Label">Q1｜和我介紹你們的故事吧！請問是哪兩位新人要結婚？</p>
            <textarea id="ai_q1" placeholder="例：從一封訊息開始，後來變成一張又一張機票..."></textarea>
            <div class="hint" id="q1Hint">小提示：可以寫「如何認識 / 相處日常 / 轉折點」。</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-danger" type="button" id="clearAllBtn1">清空</button>
          <button class="btn btn-primary" type="button" id="toQ2Btn">下一題</button>
        </div>

        <div class="status" id="qStatus1"></div>
      </div>
    </section>

    <!-- Page 2: Q2 -->
    <section class="page" id="page-q2">
      <div class="qstage">
        <div class="qtop">
          <span class="tag" id="qaTag2">AI 問答</span>
          <span class="step" id="step2">Step 2 / 4</span>
        </div>

        <div class="qcenter">
          <div class="qbox">
            <p class="qlabel" id="q2Label">Q2｜你最喜歡對方的一件小事？（具體）</p>
            <textarea id="ai_q2" placeholder="例：她每次都會記得我愛吃什麼..."></textarea>
            <div class="hint" id="q2Hint">小提示：越具體越可愛（習慣、口頭禪、貼心小動作）。</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-ghost" type="button" id="backToQ1Btn">上一題</button>
          <button class="btn btn-danger" type="button" id="clearAllBtn2">清空</button>
          <button class="btn btn-primary" type="button" id="toQ3Btn">下一題</button>
        </div>

        <div class="status" id="qStatus2"></div>
      </div>
    </section>

    <!-- Page 3: Q3 -->
    <section class="page" id="page-q3">
      <div class="qstage">
        <div class="qtop">
          <span class="tag" id="qaTag3">AI 問答</span>
          <span class="step" id="step3">Step 3 / 4</span>
        </div>

        <div class="qcenter">
          <div class="qbox">
            <p class="qlabel" id="q3Label">Q3｜和我說說婚禮會怎麼進行～時間地點是最重要的！</p>
            <textarea id="ai_q3" placeholder="例：希望大家感受到我們很認真把彼此當成家人..."></textarea>

            <div class="divider" style="margin:14px 0 12px;"></div>

            <label for="ai_style" id="styleLabel">口吻（第一人稱）</label>
            <input id="ai_style" placeholder="例：溫柔、幽默、像我平常打字那樣" />
            <div class="hint" id="styleHint">用來讓 AI 模仿你的語氣（可留空）。</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-ghost" type="button" id="backToQ2Btn">上一題</button>
          <button class="btn btn-danger" type="button" id="clearAllBtn3">清空</button>
          <button class="btn btn-primary" type="button" id="genToFormBtn">生成文案 → 進入表格</button>
        </div>

        <div class="status" id="qStatus3"></div>
      </div>
    </section>

    <!-- Page 4: Form -->
    <section class="page" id="page-form">
      <form id="inviteForm" class="card" enctype="multipart/form-data">
        <div class="section-title">
          <h2 id="formTitle">基本資訊</h2>
          <span class="tag" id="formTag">必填</span>
        </div>

        <div class="grid">
          <div>
            <label for="couple_title" id="lblCoupleTitle">新人稱呼（標題）</label>
            <input id="couple_title" name="couple_title" placeholder="例：Chun-Wei & Yerim" required />
            <div class="hint" id="hintCoupleTitle">會出現在封面大標題。</div>
          </div>

          <div>
            <label for="page_title" id="lblPageTitle">瀏覽器標題（title）</label>
            <input id="page_title" name="page_title" placeholder="例：Chun-Wei & Yerim｜婚禮喜帖" required />
          </div>

          <div>
            <label for="wedding_date_text" id="lblDate">日期（顯示文字）</label>
            <input id="wedding_date_text" name="wedding_date_text" placeholder="例：2027 / 01 / 16 (六)" required />
          </div>

          <div>
            <label for="wedding_time_text" id="lblTime">時間（顯示文字）</label>
            <input id="wedding_time_text" name="wedding_time_text" placeholder="例：入場 18:00，儀式 18:30" required />
          </div>

          <div>
            <label for="venue_name" id="lblVenueName">地點名稱</label>
            <input id="venue_name" name="venue_name" placeholder="例：首爾君悅酒店" required />
          </div>

          <div>
            <label for="venue_address" id="lblVenueAddr">地址</label>
            <input id="venue_address" name="venue_address" placeholder="例：韓國 首爾特別市 ..." required />
          </div>

          <div>
            <label for="map_url" id="lblMap">Google Map 連結</label>
            <input id="map_url" name="map_url" placeholder="貼 Google Maps 分享連結（或 search/?api=1...）" required />
          </div>

          <div>
            <label for="rsvp_url" id="lblRsvp">RSVP 表單連結</label>
            <input id="rsvp_url" name="rsvp_url" placeholder="Google 表單連結 / 其他報名表" required />
          </div>
        </div>

        <div class="divider"></div>

        <div class="section-title">
          <h2 id="copyTitle">文案</h2>
          <span class="tag" id="copyTag">可先用預設值</span>
        </div>

        <div class="grid">
          <div>
            <label for="cover_subtitle" id="lblCoverSub">封面短句</label>
            <textarea id="cover_subtitle" name="cover_subtitle" placeholder="例：誠摯邀請您，一起見證我們步入新的旅程。" required></textarea>
          </div>

          <div>
            <label for="story_subtitle" id="lblStorySub">故事頁副標</label>
            <textarea id="story_subtitle" name="story_subtitle" placeholder="例：跨越台南與首爾的日常..." required></textarea>
          </div>

          <div>
            <label for="story_p1" id="lblStoryP1">故事段落 1</label>
            <textarea id="story_p1" name="story_p1" required></textarea>
          </div>

          <div>
            <label for="story_p2" id="lblStoryP2">故事段落 2</label>
            <textarea id="story_p2" name="story_p2" required></textarea>
          </div>
        </div>

        <div class="divider"></div>

        <div class="section-title">
          <h2 id="tlTitle">當天流程（3 條）</h2>
          <span class="tag" id="tlTag">必填</span>
        </div>

        <div class="grid">
          <div>
            <label id="lblTl1Time">流程 1 時間</label>
            <input name="tl1_time" placeholder="例：18:00" required />
          </div>
          <div>
            <label id="lblTl1Text">流程 1 內容</label>
            <input name="tl1_text" placeholder="例：賓客入場、簡單合照" required />
          </div>

          <div>
            <label id="lblTl2Time">流程 2 時間</label>
            <input name="tl2_time" placeholder="例：18:30" required />
          </div>
          <div>
            <label id="lblTl2Text">流程 2 內容</label>
            <input name="tl2_text" placeholder="例：證婚儀式開始" required />
          </div>

          <div>
            <label id="lblTl3Time">流程 3 時間</label>
            <input name="tl3_time" placeholder="例：19:30" required />
          </div>
          <div>
            <label id="lblTl3Text">流程 3 內容</label>
            <input name="tl3_text" placeholder="例：晚宴、致詞與互動時間" required />
          </div>
        </div>

        <div class="divider"></div>

        <div class="section-title">
          <h2 id="photoTitle">照片上傳（4 張）</h2>
          <span class="tag" id="photoTag">必填</span>
        </div>

        <div class="uploader">
          <div class="upload-box wide">
            <div class="top">
              <div class="name" id="photoName">上傳 4 張照片（依序套用）</div>
            </div>

            <input type="file" name="photos" accept="image/*" multiple required />

            <small id="photoHelp">
              請一次選取 <b>4 張照片</b>，將依序套用為：<br/>
              ① 封面（Cover） → ② 故事（Story） → ③ 資訊（Details） → ④ RSVP
              <br/>
              建議橫式、主體置中。
            </small>
          </div>
        </div>

        <!-- 固定文字（可照你模板維持） -->
        <input type="hidden" name="brand_title" value="C & Y Wedding" />
        <input type="hidden" name="brand_sub" value="滑鼠滾輪一次切換一頁" />
        <input type="hidden" name="rsvp_button_text" value="我要出席 RSVP" />

        <input type="hidden" name="btn_view_details" value="查看婚禮資訊" />
        <input type="hidden" name="btn_our_story" value="我們的故事" />
        <input type="hidden" name="btn_next_details" value="下一頁：婚禮資訊" />
        <input type="hidden" name="btn_back_cover" value="回到封面" />
        <input type="hidden" name="story_title" value="我們的故事" />

        <input type="hidden" name="details_title" value="Wedding Day" />
        <input type="hidden" name="details_subtitle" value="當天流程與場地資訊" />
        <input type="hidden" name="btn_open_map" value="在 Google 地圖中開啟" />
        <input type="hidden" name="btn_next_rsvp" value="下一頁：RSVP" />
        <input type="hidden" name="details_note" value="＊若想內嵌 Google Map，我也可以幫你加 iframe。" />

        <input type="hidden" name="rsvp_title" value="RSVP 出席回覆" />
        <input type="hidden" name="rsvp_subtitle" value="為了讓我們能好好準備座位與餐點，請花一點時間填寫出席回覆。" />
        <input type="hidden" name="rsvp_step1" value="1) 點擊下方按鈕前往回覆表單（建議使用 Google 表單）。" />
        <input type="hidden" name="rsvp_step2" value="2) 填寫您的姓名、人數與飲食需求。" />
        <input type="hidden" name="rsvp_step3" value="3) 送出後，我們會在婚禮前再與您確認。" />
        <input type="hidden" name="btn_open_rsvp" value="前往 RSVP 表單" />
        <input type="hidden" name="rsvp_hint" value="＊若無法使用表單，也可以直接回覆這封電子喜帖的寄件人。" />

        <div class="actions" style="justify-content:flex-start">
          <button class="btn btn-primary" type="submit" id="submitBtn">生成喜帖</button>
          <button class="btn btn-ghost" type="button" id="fillDemo">填入範例</button>
          <button class="btn btn-ghost" type="button" id="backToQ3FromForm">回到問答</button>
        </div>

        <div id="status" class="status"></div>
      </form>
    </section>
  </div>

  <!-- Generating overlay -->
  <div class="overlay" id="overlay">
    <div class="overlay-card">
      <div class="spinner" aria-hidden="true"></div>
      <p class="gen-title" id="genTitle">正在生成喜帖文案…</p>
      <div class="gen-line" id="genLine">把你們的回答變成更像喜帖的語氣。</div>
      <div class="gen-sub" id="genSub">完成後會自動帶你進入表格頁。</div>
    </div>
  </div>

  <script>
    /***********************
     * i18n (ZH/EN/KO/VI)
     ***********************/
    const i18n = {
      zh: {
        docTitle: '建立你的電子喜帖',
        h1: '建立你的電子喜帖',
        sub: '先回答 3 題（逐題翻頁），AI 會幫你把文案填進表格。最後再上傳 4 張背景照片生成「四頁翻頁」模板。<br/>建議照片用橫式、解析度至少 1600px 寬（手機原圖通常 OK）。',
        mvpTag: '四頁流程 MVP',
        qaTag: 'AI 問答',
        step1: 'Step 1 / 4',
        step2: 'Step 2 / 4',
        step3: 'Step 3 / 4',
        q1: 'Q1｜和我介紹你們的故事吧！請問是哪兩位新人要結婚？',
        q1ph: '例：從一封訊息開始，後來變成一張又一張機票...',
        q1hint: '小提示：可以寫「如何認識 / 相處日常 / 轉折點」。',
        q2: 'Q2｜你最喜歡對方的一件小事？（具體）',
        q2ph: '例：她每次都會記得我愛吃什麼...',
        q2hint: '小提示：越具體越可愛（習慣、口頭禪、貼心小動作）。',
        q3: 'Q3｜和我說說婚禮會怎麼進行～時間地點是最重要的！',
        q3ph: '例：希望大家感受到我們很認真把彼此當成家人...',
        styleLabel: '口吻（第一人稱）',
        stylePh: '例：溫柔、幽默、像我平常打字那樣',
        styleHint: '用來讓 AI 模仿你的語氣（可留空）。',

        btnNext: '下一題',
        btnPrev: '上一題',
        btnClear: '清空',
        btnGenToForm: '生成文案 → 進入表格',
        genTitle: '正在生成喜帖文案…',
        genSub: '完成後會自動帶你進入表格頁。',

        formTitle: '基本資訊',
        formTag: '必填',
        lblCoupleTitle: '新人稱呼（標題）',
        hintCoupleTitle: '會出現在封面大標題。',
        lblPageTitle: '瀏覽器標題（title）',
        lblDate: '日期（顯示文字）',
        lblTime: '時間（顯示文字）',
        lblVenueName: '地點名稱',
        lblVenueAddr: '地址',
        lblMap: 'Google Map 連結',
        lblRsvp: 'RSVP 表單連結',
        copyTitle: '文案',
        copyTag: '可先用預設值',
        lblCoverSub: '封面短句',
        lblStorySub: '故事頁副標',
        lblStoryP1: '故事段落 1',
        lblStoryP2: '故事段落 2',
        tlTitle: '當天流程（3 條）',
        tlTag: '必填',
        lblTl1Time: '流程 1 時間',
        lblTl1Text: '流程 1 內容',
        lblTl2Time: '流程 2 時間',
        lblTl2Text: '流程 2 內容',
        lblTl3Time: '流程 3 時間',
        lblTl3Text: '流程 3 內容',
        photoTitle: '照片上傳（4 張）',
        photoTag: '必填',
        photoName: '上傳 4 張照片（依序套用）',
        submitBtn: '生成喜帖',
        demoBtn: '填入範例',
        backToQA: '回到問答',

        alerts: {
          needQ1: '請先回答 Q1。',
          needQ2: '請先回答 Q2。',
          needQ3: '請先回答 Q3。',
          need4Photos: '請一次選取「剛好 4 張」照片，會依順序套用。',
        }
      },

      en: {
        docTitle: 'Create Your Wedding e-Invitation',
        h1: 'Create Your Wedding e-Invitation',
        sub: 'Answer 3 questions (one per page). AI will draft copy and fill the form for you. Then upload 4 background photos to generate the 4-page template.<br/>Use landscape photos, ideally ≥ 1600px wide.',
        mvpTag: '4-step MVP',
        qaTag: 'AI Q&A',
        step1: 'Step 1 / 4',
        step2: 'Step 2 / 4',
        step3: 'Step 3 / 4',
        q1: 'Q1｜Tell me your story — who are the two people getting married?',
        q1ph: 'e.g., It started with a message, then became flight tickets…',
        q1hint: 'Tip: how you met / daily moments / turning point.',
        q2: 'Q2｜One small thing you love about your partner (be specific).',
        q2ph: 'e.g., They always remember what I like to eat…',
        q2hint: 'Tip: the more specific, the sweeter.',
        q3: 'Q3｜How will the wedding day flow? Time & place matter most!',
        q3ph: 'e.g., We want everyone to feel…',
        styleLabel: 'Tone (first-person)',
        stylePh: 'e.g., warm, witty, like how I usually text',
        styleHint: 'Optional — helps AI mimic your voice.',

        btnNext: 'Next',
        btnPrev: 'Back',
        btnClear: 'Clear',
        btnGenToForm: 'Generate copy → Go to form',
        genTitle: 'Generating invitation copy…',
        genSub: 'You’ll be taken to the form automatically.',

        formTitle: 'Basic Info',
        formTag: 'Required',
        lblCoupleTitle: 'Couple title (headline)',
        hintCoupleTitle: 'Shown on the cover title.',
        lblPageTitle: 'Browser title',
        lblDate: 'Date (display text)',
        lblTime: 'Time (display text)',
        lblVenueName: 'Venue name',
        lblVenueAddr: 'Address',
        lblMap: 'Google Map link',
        lblRsvp: 'RSVP form link',
        copyTitle: 'Copy',
        copyTag: 'You can edit later',
        lblCoverSub: 'Cover line',
        lblStorySub: 'Story subtitle',
        lblStoryP1: 'Story paragraph 1',
        lblStoryP2: 'Story paragraph 2',
        tlTitle: 'Timeline (3 items)',
        tlTag: 'Required',
        lblTl1Time: 'Timeline 1 time',
        lblTl1Text: 'Timeline 1 text',
        lblTl2Time: 'Timeline 2 time',
        lblTl2Text: 'Timeline 2 text',
        lblTl3Time: 'Timeline 3 time',
        lblTl3Text: 'Timeline 3 text',
        photoTitle: 'Upload Photos (4)',
        photoTag: 'Required',
        photoName: 'Upload 4 photos (in order)',
        submitBtn: 'Create Invitation',
        demoBtn: 'Fill Demo',
        backToQA: 'Back to Q&A',

        alerts: {
          needQ1: 'Please answer Q1 first.',
          needQ2: 'Please answer Q2 first.',
          needQ3: 'Please answer Q3 first.',
          need4Photos: 'Please select exactly 4 photos (in order).',
        }
      },

      ko: {
        docTitle: '모바일 청첩장 만들기',
        h1: '모바일 청첩장 만들기',
        sub: '질문 3개를 한 페이지씩 답하면, AI가 문구를 만들어 아래 폼에 자동 입력해요. 그 다음 배경 사진 4장을 올리면 4페이지 템플릿이 생성돼요.<br/>가로 사진(폭 1600px 이상 권장).',
        mvpTag: '4단계 MVP',
        qaTag: 'AI 문답',
        step1: 'Step 1 / 4',
        step2: 'Step 2 / 4',
        step3: 'Step 3 / 4',
        q1: 'Q1｜두 분의 이야기를 들려주세요. 누가 결혼하나요?',
        q1ph: '예: 한 통의 메시지에서 시작해 항공권이 되었어요…',
        q1hint: '팁: 만남 / 일상 / 전환점.',
        q2: 'Q2｜상대의 “작은” 매력 한 가지(구체적으로).',
        q2ph: '예: 항상 내가 좋아하는 걸 기억해줘요…',
        q2hint: '팁: 구체적일수록 더 귀여워요.',
        q3: 'Q3｜결혼식은 어떻게 진행되나요? 시간/장소가 중요해요!',
        q3ph: '예: 모두가 느꼈으면 하는 분위기…',
        styleLabel: '말투(1인칭)',
        stylePh: '예: 따뜻하게, 유머 있게, 평소 문자처럼',
        styleHint: '선택 — AI가 말투를 맞추는 데 도움돼요.',

        btnNext: '다음',
        btnPrev: '이전',
        btnClear: '초기화',
        btnGenToForm: '문구 생성 → 폼으로',
        genTitle: '청첩장 문구 생성 중…',
        genSub: '완료되면 자동으로 폼 페이지로 이동해요.',

        formTitle: '기본 정보',
        formTag: '필수',
        lblCoupleTitle: '신랑/신부 표기(제목)',
        hintCoupleTitle: '커버의 큰 제목에 표시돼요.',
        lblPageTitle: '브라우저 제목',
        lblDate: '날짜(표시용)',
        lblTime: '시간(표시용)',
        lblVenueName: '장소명',
        lblVenueAddr: '주소',
        lblMap: '구글맵 링크',
        lblRsvp: 'RSVP 링크',
        copyTitle: '문구',
        copyTag: '나중에 수정 가능',
        lblCoverSub: '커버 한 줄',
        lblStorySub: '스토리 부제',
        lblStoryP1: '스토리 1문단',
        lblStoryP2: '스토리 2문단',
        tlTitle: '타임라인(3개)',
        tlTag: '필수',
        lblTl1Time: '타임라인 1 시간',
        lblTl1Text: '타임라인 1 내용',
        lblTl2Time: '타임라인 2 시간',
        lblTl2Text: '타임라인 2 내용',
        lblTl3Time: '타임라인 3 시간',
        lblTl3Text: '타임라인 3 내용',
        photoTitle: '사진 업로드(4장)',
        photoTag: '필수',
        photoName: '사진 4장 업로드(순서대로)',
        submitBtn: '청첩장 생성',
        demoBtn: '예시 채우기',
        backToQA: '문답으로',

        alerts: {
          needQ1: 'Q1을 먼저 작성해 주세요.',
          needQ2: 'Q2를 먼저 작성해 주세요.',
          needQ3: 'Q3을 먼저 작성해 주세요.',
          need4Photos: '사진을 정확히 4장 선택해 주세요.',
        }
      },

      vi: {
        docTitle: 'Tạo thiệp cưới điện tử',
        h1: 'Tạo thiệp cưới điện tử',
        sub: 'Trả lời 3 câu hỏi (mỗi câu 1 trang). AI sẽ viết nội dung và tự điền vào biểu mẫu. Sau đó tải lên 4 ảnh nền để tạo mẫu 4 trang.<br/>Khuyên dùng ảnh ngang, rộng ≥ 1600px.',
        mvpTag: 'MVP 4 bước',
        qaTag: 'Hỏi đáp AI',
        step1: 'Bước 1 / 4',
        step2: 'Bước 2 / 4',
        step3: 'Bước 3 / 4',
        q1: 'Q1｜Kể cho mình câu chuyện của hai bạn—ai là hai người sắp cưới?',
        q1ph: 'Ví dụ: Bắt đầu từ một tin nhắn rồi thành những chuyến bay…',
        q1hint: 'Gợi ý: gặp nhau thế nào / khoảnh khắc thường ngày / bước ngoặt.',
        q2: 'Q2｜Một điều nhỏ bạn thích ở người ấy (cụ thể).',
        q2ph: 'Ví dụ: Luôn nhớ mình thích ăn gì…',
        q2hint: 'Gợi ý: càng cụ thể càng dễ thương.',
        q3: 'Q3｜Đám cưới sẽ diễn ra ra sao? Thời gian & địa điểm rất quan trọng!',
        q3ph: 'Ví dụ: Bạn muốn khách cảm nhận điều gì…',
        styleLabel: 'Giọng điệu (ngôi “tôi”)',
        stylePh: 'Ví dụ: ấm áp, hài hước, như cách mình nhắn tin',
        styleHint: 'Tuỳ chọn — giúp AI bắt đúng giọng.',

        btnNext: 'Tiếp',
        btnPrev: 'Quay lại',
        btnClear: 'Xoá',
        btnGenToForm: 'Tạo nội dung → Vào biểu mẫu',
        genTitle: 'Đang tạo nội dung thiệp…',
        genSub: 'Xong sẽ tự chuyển sang trang biểu mẫu.',

        formTitle: 'Thông tin cơ bản',
        formTag: 'Bắt buộc',
        lblCoupleTitle: 'Tiêu đề cô dâu & chú rể',
        hintCoupleTitle: 'Hiển thị ở trang bìa.',
        lblPageTitle: 'Tiêu đề trình duyệt',
        lblDate: 'Ngày (hiển thị)',
        lblTime: 'Giờ (hiển thị)',
        lblVenueName: 'Tên địa điểm',
        lblVenueAddr: 'Địa chỉ',
        lblMap: 'Link Google Maps',
        lblRsvp: 'Link RSVP',
        copyTitle: 'Nội dung',
        copyTag: 'Có thể chỉnh sửa',
        lblCoverSub: 'Câu ngắn trang bìa',
        lblStorySub: 'Phụ đề câu chuyện',
        lblStoryP1: 'Đoạn 1',
        lblStoryP2: 'Đoạn 2',
        tlTitle: 'Lịch trình (3 mục)',
        tlTag: 'Bắt buộc',
        lblTl1Time: 'Mục 1 - giờ',
        lblTl1Text: 'Mục 1 - nội dung',
        lblTl2Time: 'Mục 2 - giờ',
        lblTl2Text: 'Mục 2 - nội dung',
        lblTl3Time: 'Mục 3 - giờ',
        lblTl3Text: 'Mục 3 - nội dung',
        photoTitle: 'Tải ảnh (4 ảnh)',
        photoTag: 'Bắt buộc',
        photoName: 'Tải lên 4 ảnh (theo thứ tự)',
        submitBtn: 'Tạo thiệp',
        demoBtn: 'Điền ví dụ',
        backToQA: 'Quay lại hỏi đáp',

        alerts: {
          needQ1: 'Vui lòng trả lời Q1 trước.',
          needQ2: 'Vui lòng trả lời Q2 trước.',
          needQ3: 'Vui lòng trả lời Q3 trước.',
          need4Photos: 'Vui lòng chọn đúng 4 ảnh theo thứ tự.',
        }
      },
    };

    let currentLang = 'zh';

    function applyLang(lang){
      currentLang = lang;
      const t = i18n[lang];

      document.getElementById('docTitle').textContent = t.docTitle;
      document.title = t.docTitle;
      document.getElementById('h1Title').textContent = t.h1;
      document.getElementById('subTitle').innerHTML = t.sub;
      document.getElementById('mvpTag').textContent = t.mvpTag;

      document.getElementById('qaTag').textContent = t.qaTag;
      document.getElementById('qaTag2').textContent = t.qaTag;
      document.getElementById('qaTag3').textContent = t.qaTag;

      document.getElementById('step1').textContent = t.step1;
      document.getElementById('step2').textContent = t.step2;
      document.getElementById('step3').textContent = t.step3;

      document.getElementById('q1Label').textContent = t.q1;
      document.getElementById('ai_q1').placeholder = t.q1ph;
      document.getElementById('q1Hint').textContent = t.q1hint;

      document.getElementById('q2Label').textContent = t.q2;
      document.getElementById('ai_q2').placeholder = t.q2ph;
      document.getElementById('q2Hint').textContent = t.q2hint;

      document.getElementById('q3Label').textContent = t.q3;
      document.getElementById('ai_q3').placeholder = t.q3ph;

      document.getElementById('styleLabel').textContent = t.styleLabel;
      document.getElementById('ai_style').placeholder = t.stylePh;
      document.getElementById('styleHint').textContent = t.styleHint;

      // buttons
      document.getElementById('toQ2Btn').textContent = t.btnNext;
      document.getElementById('toQ3Btn').textContent = t.btnNext;
      document.getElementById('backToQ1Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;

      document.getElementById('backToQ1Btn').textContent = t.btnPrev;
      document.getElementById('backToQ2Btn').textContent = t.btnPrev;
      document.getElementById('backToQ3Btn').textContent = t.btnPrev;

      document.getElementById('clearAllBtn1').textContent = t.btnClear;
      document.getElementById('clearAllBtn2').textContent = t.btnClear;
      document.getElementById('clearAllBtn3').textContent = t.btnClear;

      document.getElementById('genToFormBtn').textContent = t.btnGenToForm;

      // overlay
      document.getElementById('genTitle').textContent = t.genTitle;
      document.getElementById('genSub').textContent = t.genSub;

      // form
      document.getElementById('formTitle').textContent = t.formTitle;
      document.getElementById('formTag').textContent = t.formTag;
      document.getElementById('lblCoupleTitle').textContent = t.lblCoupleTitle;
      document.getElementById('hintCoupleTitle').textContent = t.hintCoupleTitle;
      document.getElementById('lblPageTitle').textContent = t.lblPageTitle;
      document.getElementById('lblDate').textContent = t.lblDate;
      document.getElementById('lblTime').textContent = t.lblTime;
      document.getElementById('lblVenueName').textContent = t.lblVenueName;
      document.getElementById('lblVenueAddr').textContent = t.lblVenueAddr;
      document.getElementById('lblMap').textContent = t.lblMap;
      document.getElementById('lblRsvp').textContent = t.lblRsvp;

      document.getElementById('copyTitle').textContent = t.copyTitle;
      document.getElementById('copyTag').textContent = t.copyTag;
      document.getElementById('lblCoverSub').textContent = t.lblCoverSub;
      document.getElementById('lblStorySub').textContent = t.lblStorySub;
      document.getElementById('lblStoryP1').textContent = t.lblStoryP1;
      document.getElementById('lblStoryP2').textContent = t.lblStoryP2;

      document.getElementById('tlTitle').textContent = t.tlTitle;
      document.getElementById('tlTag').textContent = t.tlTag;
      document.getElementById('lblTl1Time').textContent = t.lblTl1Time;
      document.getElementById('lblTl1Text').textContent = t.lblTl1Text;
      document.getElementById('lblTl2Time').textContent = t.lblTl2Time;
      document.getElementById('lblTl2Text').textContent = t.lblTl2Text;
      document.getElementById('lblTl3Time').textContent = t.lblTl3Time;
      document.getElementById('lblTl3Text').textContent = t.lblTl3Text;

      document.getElementById('photoTitle').textContent = t.photoTitle;
      document.getElementById('photoTag').textContent = t.photoTag;
      document.getElementById('photoName').textContent = t.photoName;

      document.getElementById('submitBtn').textContent = t.submitBtn;
      document.getElementById('fillDemo').textContent = t.demoBtn;
      document.getElementById('backToQ3FromForm').textContent = t.backToQA;
    }

    // language button event
    document.querySelectorAll('.langbtn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.langbtn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        applyLang(btn.dataset.lang);
      });
    });

    /***********************
     * Page transitions (fade out/in)
     ***********************/
    const pages = {
      q1: document.getElementById('page-q1'),
      q2: document.getElementById('page-q2'),
      q3: document.getElementById('page-q3'),
      form: document.getElementById('page-form'),
    };

    function showPage(key){
      const target = pages[key];
      if(!target) return;

      const current = document.querySelector('.page.active');
      if(current === target) return;

      // fade out current
      if(current){
        current.classList.remove('visible');
        setTimeout(() => {
          current.classList.remove('active');
          // activate target
          target.classList.add('active');
          // force reflow for transition
          void target.offsetWidth;
          target.classList.add('visible');
          window.scrollTo({ top: 0, behavior: 'instant' });
        }, 320);
      }else{
        target.classList.add('active');
        void target.offsetWidth;
        target.classList.add('visible');
      }
    }

    /***********************
     * Clear + simple validation
     ***********************/
    function clearAll(){
      document.getElementById('ai_q1').value = '';
      document.getElementById('ai_q2').value = '';
      document.getElementById('ai_q3').value = '';
      document.getElementById('ai_style').value = '';
      ['qStatus1','qStatus2','qStatus3'].forEach(id => {
        const el = document.getElementById(id);
        el.textContent = '';
        el.className = 'status';
      });
    }
    document.getElementById('clearAllBtn1').addEventListener('click', clearAll);
    document.getElementById('clearAllBtn2').addEventListener('click', clearAll);
    document.getElementById('clearAllBtn3').addEventListener('click', clearAll);

    function setQStatus(pageId, msg, ok=false){
      const el = document.getElementById(pageId);
      el.textContent = msg || '';
      el.className = 'status ' + (ok ? 'ok' : (msg ? 'error' : ''));
    }

    /***********************
     * Nav buttons
     ***********************/
    document.getElementById('toQ2Btn').addEventListener('click', () => {
      const a1 = document.getElementById('ai_q1').value.trim();
      if(!a1) return setQStatus('qStatus1', i18n[currentLang].alerts.needQ1, false);
      setQStatus('qStatus1', '', true);
      showPage('q2');
      setTimeout(() => document.getElementById('ai_q2').focus(), 380);
    });

    document.getElementById('backToQ1Btn').addEventListener('click', () => showPage('q1'));

    document.getElementById('toQ3Btn').addEventListener('click', () => {
      const a2 = document.getElementById('ai_q2').value.trim();
      if(!a2) return setQStatus('qStatus2', i18n[currentLang].alerts.needQ2, false);
      setQStatus('qStatus2', '', true);
      showPage('q3');
      setTimeout(() => document.getElementById('ai_q3').focus(), 380);
    });

    document.getElementById('backToQ2Btn').addEventListener('click', () => showPage('q2'));

    document.getElementById('backToQ3Btn').addEventListener('click', () => showPage('q3'));

    document.getElementById('backToQ3FromForm').addEventListener('click', () => showPage('q3'));

    /***********************
     * Generating overlay: random short lines
     ***********************/
    const overlay = document.getElementById('overlay');
    const genLine = document.getElementById('genLine');

    const randomLines = {
      zh: [
        '把你們的回答變得更像喜帖的語氣。',
        '整理成「短句 + 故事段落」的節奏。',
        '幫你抓出最甜的那一句。',
        '把細節留著、把情緒放大一點點。',
        '讓每一段都更像“你們”。',
      ],
      en: [
        'Turning your answers into invitation-style copy.',
        'Shaping a warm, concise rhythm.',
        'Finding the sweetest detail to highlight.',
        'Keeping it classy—no cringe, no brag.',
        'Making it sound like you.',
      ],
      ko: [
        '답변을 청첩장 문구로 자연스럽게 다듬는 중…',
        '짧은 문장 + 스토리 흐름으로 정리 중…',
        '가장 설레는 포인트를 뽑는 중…',
        '과하지 않게, 우아하게.',
        '두 분만의 톤으로 맞추는 중…',
      ],
      vi: [
        'Đang chuyển câu trả lời thành văn phong thiệp mời…',
        'Sắp xếp nhịp: câu ngắn + câu chuyện…',
        'Chọn ra chi tiết dễ thương nhất…',
        'Thanh lịch, vừa đủ, không phô trương.',
        'Đưa về đúng “giọng” của hai bạn.',
      ],
    };

    function showOverlay(){
      overlay.classList.add('show');
      let alive = true;

      const tick = () => {
        if(!alive) return;
        const arr = randomLines[currentLang] || randomLines.zh;
        const line = arr[Math.floor(Math.random()*arr.length)];
        genLine.style.opacity = '0.15';
        setTimeout(() => {
          genLine.textContent = line;
          genLine.style.opacity = '1';
        }, 180);
      };

      tick();
      const timer = setInterval(tick, 950);

      return () => {
        alive = false;
        clearInterval(timer);
        overlay.classList.remove('show');
      };
    }

    /***********************
     * AI prefill (POST /api/ai_prefill) then go to form page
     ***********************/
    async function aiPrefillAndGoForm(){
      const a1 = document.getElementById('ai_q1').value.trim();
      const a2 = document.getElementById('ai_q2').value.trim();
      const a3 = document.getElementById('ai_q3').value.trim();
      const style = document.getElementById('ai_style').value.trim();

      if(!a1) return setQStatus('qStatus1', i18n[currentLang].alerts.needQ1, false);
      if(!a2) return setQStatus('qStatus2', i18n[currentLang].alerts.needQ2, false);
      if(!a3) return setQStatus('qStatus3', i18n[currentLang].alerts.needQ3, false);

      setQStatus('qStatus3', '', true);

      const hideOverlay = showOverlay();

      const payload = {
        // 你後端原本吃 answers[]，我維持相容
        answers: [
          { q: 'Q1', a: a1 },
          { q: 'Q2', a: a2 },
          { q: 'Q3', a: a3 },
          { q: 'tone', a: style },
          { q: 'language', a: currentLang }, // 讓後端知道語言 zh/en/ko/vi
        ]
      };

      try{
        const res = await fetch('/api/ai_prefill', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });

        // 先讀 text，避免後端回 HTML 直接炸
        const text = await res.text();
        let data;
        try { data = JSON.parse(text); }
        catch {
          throw new Error(`AI 回傳不是 JSON（HTTP ${res.status}）：${text.slice(0, 200)}`);
        }

        if(!res.ok || !data.ok) throw new Error(data?.error || `AI 失敗（HTTP ${res.status}）`);

        const fill = data.data || {};

        // 填到表單（有值才覆蓋）
        const form = document.getElementById('inviteForm');
        const setIf = (name, v) => {
          if(v === undefined || v === null) return;
          const s = String(v).trim();
          if(!s) return;
          if(form[name]) form[name].value = s;
        };

        setIf('cover_subtitle', fill.cover_subtitle);
        setIf('story_subtitle', fill.story_subtitle);
        setIf('story_p1', fill.story_p1);
        setIf('story_p2', fill.story_p2);

        // 你也允許 AI 生成基本欄位（有值才覆蓋）
        setIf('page_title', fill.page_title);
        setIf('couple_title', fill.couple_title);
        setIf('wedding_date_text', fill.wedding_date_text);
        setIf('wedding_time_text', fill.wedding_time_text);
        setIf('venue_name', fill.venue_name);
        setIf('venue_address', fill.venue_address);
        setIf('map_url', fill.map_url);
        setIf('rsvp_url', fill.rsvp_url);

        // timeline
        setIf('tl1_time', fill.tl1_time);
        setIf('tl1_text', fill.tl1_text);
        setIf('tl2_time', fill.tl2_time);
        setIf('tl2_text', fill.tl2_text);
        setIf('tl3_time', fill.tl3_time);
        setIf('tl3_text', fill.tl3_text);

        hideOverlay();
        showPage('form');

        // 小提示：若 AI 沒填 timeline，給你一個不打擾的提醒
        const statusEl = document.getElementById('status');
        statusEl.className = 'status ok';
        statusEl.textContent = '✅ AI 已填入文案，你可以再微調後上傳照片生成喜帖。';

      }catch(err){
        hideOverlay();
        setQStatus('qStatus3', '❌ ' + err.message, false);
      }
    }

    document.getElementById('genToFormBtn').addEventListener('click', aiPrefillAndGoForm);

    /***********************
     * Form demo fill
     ***********************/
    const form = document.getElementById('inviteForm');
    document.getElementById('fillDemo').addEventListener('click', () => {
      form.page_title.value = 'Chun-Wei & Yerim｜婚禮喜帖';
      form.couple_title.value = 'Chun-Wei & Yerim';
      form.wedding_date_text.value = '2027 / 01 / 16 (六)';
      form.wedding_time_text.value = '入場 18:00，儀式 18:30';
      form.venue_name.value = '首爾君悅酒店';
      form.venue_address.value = '韓國 首爾特別市 龍산구 소월로 322 (한남동) 04347';
      form.map_url.value = 'https://www.google.com/maps/search/?api=1&query=Grand%20Hyatt%20Seoul';
      form.rsvp_url.value = 'https://docs.google.com/forms';

      form.cover_subtitle.value = '誠摯邀請您，一起見證我們步入新的旅程。';
      form.story_subtitle.value = '跨越台南與首爾的日常，慢慢疊起來，就變成了今天的我們。';
      form.story_p1.value = '從一通訊息、一張機票開始，我們學會在不同的城市裡替彼此保留一個位置，期待著下一次重逢。';
      form.story_p2.value = '現在，我們想邀請你／妳，一起來到這一天，見證我們把這段旅程，變成同一個「家」。';

      form.tl1_time.value = '18:00';
      form.tl1_text.value = '賓客入場、簡單合照';
      form.tl2_time.value = '18:30';
      form.tl2_text.value = '證婚儀式開始';
      form.tl3_time.value = '19:30';
      form.tl3_text.value = '晚宴、致詞與互動時間';
    });

    /***********************
     * Photo count guard (exactly 4)
     ***********************/
    const photoInput = document.querySelector('input[name="photos"]');
    photoInput.addEventListener('change', () => {
      if (photoInput.files.length !== 4) {
        alert(i18n[currentLang].alerts.need4Photos);
        photoInput.value = "";
      }
    });

    /***********************
     * Submit: POST /api/create (multipart/form-data)
     ***********************/
    const statusEl = document.getElementById('status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '正在上傳與生成中…';
      statusEl.className = 'status';

      const fd = new FormData(form);

      try {
        const res = await fetch('/api/create', { method: 'POST', body: fd });

        // 先讀 text，避免不是 JSON 就炸
        const text = await res.text();
        console.log('status:', res.status);
        console.log('response text:', text);

        if (!res.ok) {
          throw new Error(`伺服器回應失敗：${res.status}\n${text.slice(0, 200)}`);
        }

        // 再轉 JSON
        let data;
        try { data = JSON.parse(text); }
        catch { throw new Error(`伺服器回傳不是 JSON：${text.slice(0,200)}`); }

        statusEl.innerHTML = `✅ 已生成：<a href="${data.url}" target="_blank" style="text-decoration:underline">${data.url}</a>`;
        statusEl.classList.add('ok');
      } catch (err) {
        statusEl.textContent = '❌ 生成失敗：' + err.message;
        statusEl.classList.add('error');
      }
    });

    // init
    applyLang('zh');
    setTimeout(() => document.getElementById('ai_q1').focus(), 200);
  </script>
</body>
</html>
