<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>建立你的電子喜帖</title>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0b0f;
      --card: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.14);
      --text: rgba(255,255,255,0.92);
      --dim: rgba(255,255,255,0.70);
      --accent:#c9a27d;
      --accent-dark:#a07c56;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Noto Sans TC", system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 15% 10%, rgba(201,162,125,0.12), transparent 45%),
                  radial-gradient(circle at 80% 0%, rgba(255,255,255,0.06), transparent 40%),
                  var(--bg);
      color: var(--text);
    }
    .wrap{
      width: min(980px, 100%);
      margin: 0 auto;
      padding: 28px 16px 64px;
    }
    .header{
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      margin-bottom: 18px;
    }
    h1{
      font-size: 22px;
      margin:0;
      letter-spacing: .02em;
    }
    .sub{
      margin-top:8px;
      color: var(--dim);
      font-size: 13px;
      line-height: 1.6;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      margin-top: 14px;
      backdrop-filter: blur(10px);
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 760px){
      .grid{ grid-template-columns: 1fr; }
    }
    label{
      display:block;
      font-size: 12px;
      color: rgba(255,255,255,0.86);
      margin: 0 0 6px;
    }
    input, textarea{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(0,0,0,0.25);
      color: var(--text);
      outline: none;
    }
    textarea{ min-height: 86px; resize: vertical; }
    input::placeholder, textarea::placeholder{ color: rgba(255,255,255,0.45); }

    .hint{
      margin-top: 6px;
      color: rgba(255,255,255,0.55);
      font-size: 12px;
      line-height: 1.5;
    }

    .section-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .section-title h2{
      margin:0;
      font-size: 15px;
      letter-spacing:.02em;
    }
    .tag{
      font-size: 12px;
      color: rgba(255,255,255,0.75);
      border: 1px solid rgba(255,255,255,0.14);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
    }

    .uploader{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 760px){
      .uploader{ grid-template-columns: 1fr; }
    }
    .upload-box{
      border: 1px dashed rgba(255,255,255,0.22);
      border-radius: 14px;
      padding: 12px;
      background: rgba(0,0,0,0.18);
    }
    .upload-box .top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .upload-box .name{
      font-weight: 600;
      font-size: 13px;
    }
    .upload-box small{
      display:block;
      margin-top: 6px;
      color: rgba(255,255,255,0.55);
      line-height: 1.5;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      margin-top: 16px;
      align-items:center;
    }
    .btn{
      border:none;
      cursor:pointer;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 13px;
      color: #fff;
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
      user-select:none;
      transition: transform .18s ease, background .18s ease, border-color .18s ease;
      white-space: nowrap;
    }
    .btn-primary{
      background: var(--accent);
      box-shadow: var(--shadow);
    }
    .btn-primary:hover{ background: var(--accent-dark); transform: translateY(-1px); }
    .btn-ghost{
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.18);
    }
    .btn-ghost:hover{ border-color: rgba(255,255,255,0.35); transform: translateY(-1px); }

    .status{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,255,255,0.75);
    }
    .error{ color: #ffb4b4; }
    .ok{ color: #bfffd6; }

    .divider{
      height:1px;
      background: rgba(255,255,255,0.10);
      margin: 14px 0;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div>
        <h1>建立你的電子喜帖</h1>
        <div class="sub">
          填最必要的資訊 + 上傳 4 張背景照片，即可生成你那個「四頁翻頁」模板。<br/>
          建議照片用橫式、解析度至少 1600px 寬（手機原圖通常 OK）。
        </div>
      </div>
      <span class="tag">MVP 表單介面</span>
    </div>
    <div class="card" id="aiCard">
  <div class="section-title">
    <h2>AI 問答（幫你自動填表）</h2>
    <span class="tag">可選</span>
  </div>

  <div class="sub" style="margin-top:0">
    回答 3–5 題後，我會把內容自動填進下面表單（你仍可手動修改）。
  </div>

  <div class="divider"></div>

  <div class="grid">
    <div style="grid-column: 1 / -1;">
      <label for="ai_q1">Q1｜和我介紹你們的故事吧!請問是哪兩位新人要結婚？）</label>
      <textarea id="ai_q1" placeholder="例：從一封訊息開始，後來變成一張又一張機票..."></textarea>
    </div>

    <div style="grid-column: 1 / -1;">
      <label for="ai_q2">Q2｜你最喜歡對方的一件小事？（具體）</label>
      <textarea id="ai_q2" placeholder="例：她每次都會記得我愛吃什麼..."></textarea>
    </div>

    <div style="grid-column: 1 / -1;">
      <label for="ai_q3">Q3｜和我說說婚禮會怎麼進行~時間地點是最重要的!</label>
      <textarea id="ai_q3" placeholder="例：希望大家感受到我們很認真把彼此當成家人..."></textarea>
    </div>

    <div>
      <label for="ai_style">口吻（第一人稱）</label>
      <input id="ai_style" placeholder="例：溫柔、幽默、像我平常打字那樣" />
      <div class="hint">用來讓 AI 模仿你的語氣。</div>
    </div>

    <div>
      <label for="ai_lang">語言</label>
      <input id="ai_lang" value="繁體中文" />
    </div>
  </div>

  <div class="actions">
    <button class="btn btn-primary" type="button" id="aiFillBtn">用 AI 產生文案並自動填入</button>
    <button class="btn btn-ghost" type="button" id="aiClearBtn">清空問答</button>
  </div>

  <div id="aiStatus" class="status"></div>
</div>

    <form id="inviteForm" class="card" enctype="multipart/form-data">
      <div class="section-title">
        <h2>基本資訊</h2>
        <span class="tag">必填</span>
      </div>

      <div class="grid">
        <div>
          <label for="couple_title">新人稱呼（標題）</label>
          <input id="couple_title" name="couple_title" placeholder="例：Chun-Wei & Yerim" required />
          <div class="hint">會出現在封面大標題。</div>
        </div>

        <div>
          <label for="page_title">瀏覽器標題（title）</label>
          <input id="page_title" name="page_title" placeholder="例：Chun-Wei & Yerim｜婚禮喜帖" required />
        </div>

        <div>
          <label for="wedding_date_text">日期（顯示文字）</label>
          <input id="wedding_date_text" name="wedding_date_text" placeholder="例：2027 / 01 / 16 (六)" required />
        </div>

        <div>
          <label for="wedding_time_text">時間（顯示文字）</label>
          <input id="wedding_time_text" name="wedding_time_text" placeholder="例：入場 18:00，儀式 18:30" required />
        </div>

        <div>
          <label for="venue_name">地點名稱</label>
          <input id="venue_name" name="venue_name" placeholder="例：首爾君悅酒店" required />
        </div>

        <div>
          <label for="venue_address">地址</label>
          <input id="venue_address" name="venue_address" placeholder="例：韓國 首爾特別市 ..." required />
        </div>

        <div>
          <label for="map_url">Google Map 連結</label>
          <input id="map_url" name="map_url" placeholder="貼 Google Maps 分享連結（或 search/?api=1...）" required />
        </div>

        <div>
          <label for="rsvp_url">RSVP 表單連結</label>
          <input id="rsvp_url" name="rsvp_url" placeholder="Google 表單連結 / 其他報名表" required />
        </div>
      </div>

      <div class="divider"></div>

      <div class="section-title">
        <h2>文案</h2>
        <span class="tag">可先用預設值</span>
      </div>

      <div class="grid">
        <div>
          <label for="cover_subtitle">封面短句</label>
          <textarea id="cover_subtitle" name="cover_subtitle" placeholder="例：誠摯邀請您，一起見證我們步入新的旅程。" required></textarea>
        </div>

        <div>
          <label for="story_subtitle">故事頁副標</label>
          <textarea id="story_subtitle" name="story_subtitle" placeholder="例：跨越台南與首爾的日常..." required></textarea>
        </div>

        <div>
          <label for="story_p1">故事段落 1</label>
          <textarea id="story_p1" name="story_p1" required></textarea>
        </div>

        <div>
          <label for="story_p2">故事段落 2</label>
          <textarea id="story_p2" name="story_p2" required></textarea>
        </div>
      </div>

      <div class="divider"></div>

      <div class="section-title">
        <h2>當天流程（3 條）</h2>
        <span class="tag">必填</span>
      </div>

      <div class="grid">
        <div>
          <label>流程 1 時間</label>
          <input name="tl1_time" placeholder="例：18:00" required />
        </div>
        <div>
          <label>流程 1 內容</label>
          <input name="tl1_text" placeholder="例：賓客入場、簡單合照" required />
        </div>

        <div>
          <label>流程 2 時間</label>
          <input name="tl2_time" placeholder="例：18:30" required />
        </div>
        <div>
          <label>流程 2 內容</label>
          <input name="tl2_text" placeholder="例：證婚儀式開始" required />
        </div>

        <div>
          <label>流程 3 時間</label>
          <input name="tl3_time" placeholder="例：19:30" required />
        </div>
        <div>
          <label>流程 3 內容</label>
          <input name="tl3_text" placeholder="例：晚宴、致詞與互動時間" required />
        </div>
      </div>

      <div class="divider"></div>

      <div class="section-title">
  <h2>照片上傳（4 張）</h2>
  <span class="tag">必填</span>
</div>

<div class="uploader">
  <div class="upload-box wide">
    <div class="top">
      <div class="name">上傳 4 張照片（依序套用）</div>
    </div>

    <input
      type="file"
      name="photos"
      accept="image/*"
      multiple
      required
    />

    <small>
      請一次選取 <b>4 張照片</b>，將依序套用為：<br/>
      ① 封面（Cover） → ② 故事（Story） → ③ 資訊（Details） → ④ RSVP
      <br/>
      建議橫式、主體置中。
    </small>
  </div>
</div>


      <!-- 可選：如果你想讓 UI 更像你的模板，也可把這些文字固定死 -->
      <input type="hidden" name="brand_title" value="C & Y Wedding" />
      <input type="hidden" name="brand_sub" value="滑鼠滾輪一次切換一頁" />
      <input type="hidden" name="rsvp_button_text" value="我要出席 RSVP" />

      <input type="hidden" name="btn_view_details" value="查看婚禮資訊" />
      <input type="hidden" name="btn_our_story" value="我們的故事" />
      <input type="hidden" name="btn_next_details" value="下一頁：婚禮資訊" />
      <input type="hidden" name="btn_back_cover" value="回到封面" />
      <input type="hidden" name="story_title" value="我們的故事" />

      <input type="hidden" name="details_title" value="Wedding Day" />
      <input type="hidden" name="details_subtitle" value="當天流程與場地資訊" />
      <input type="hidden" name="btn_open_map" value="在 Google 地圖中開啟" />
      <input type="hidden" name="btn_next_rsvp" value="下一頁：RSVP" />
      <input type="hidden" name="details_note" value="＊若想內嵌 Google Map，我也可以幫你加 iframe。" />

      <input type="hidden" name="rsvp_title" value="RSVP 出席回覆" />
      <input type="hidden" name="rsvp_subtitle" value="為了讓我們能好好準備座位與餐點，請花一點時間填寫出席回覆。" />
      <input type="hidden" name="rsvp_step1" value="1) 點擊下方按鈕前往回覆表單（建議使用 Google 表單）。" />
      <input type="hidden" name="rsvp_step2" value="2) 填寫您的姓名、人數與飲食需求。" />
      <input type="hidden" name="rsvp_step3" value="3) 送出後，我們會在婚禮前再與您確認。" />
      <input type="hidden" name="btn_open_rsvp" value="前往 RSVP 表單" />
      <input type="hidden" name="rsvp_hint" value="＊若無法使用表單，也可以直接回覆這封電子喜帖的寄件人。" />

      <div class="actions">
        <button class="btn btn-primary" type="submit">生成喜帖</button>
        <button class="btn btn-ghost" type="button" id="fillDemo">填入範例</button>
      </div>

      <div id="status" class="status"></div>
    </form>
  </div>

  <script>
    const form = document.getElementById('inviteForm');
    const statusEl = document.getElementById('status');
    const fillDemoBtn = document.getElementById('fillDemo');

    fillDemoBtn.addEventListener('click', () => {
      form.page_title.value = 'Chun-Wei & Yerim｜婚禮喜帖';
      form.couple_title.value = 'Chun-Wei & Yerim';
      form.wedding_date_text.value = '2027 / 01 / 16 (六)';
      form.wedding_time_text.value = '入場 18:00，儀式 18:30';
      form.venue_name.value = '首爾君悅酒店';
      form.venue_address.value = '韓國 首爾特別市 龍山區 蘇月路 322號（漢南洞）04347';
      form.map_url.value = 'https://www.google.com/maps/search/?api=1&query=Grand%20Hyatt%20Seoul';
      form.rsvp_url.value = 'https://docs.google.com/forms';

      form.cover_subtitle.value = '誠摯邀請您，一起見證我們步入新的旅程。';
      form.story_subtitle.value = '跨越台南與首爾的日常，慢慢疊起來，就變成了今天的我們。';
      form.story_p1.value = '從一通訊息、一張機票開始，我們學會在不同的城市裡替彼此保留一個位置，期待著下一次重逢。';
      form.story_p2.value = '現在，我們想邀請你／妳，一起來到這一天，見證我們把這段旅程，變成同一個「家」。';

      form.tl1_time.value = '18:00';
      form.tl1_text.value = '賓客入場、簡單合照';
      form.tl2_time.value = '18:30';
      form.tl2_text.value = '證婚儀式開始';
      form.tl3_time.value = '19:30';
      form.tl3_text.value = '晚宴、致詞與互動時間';
    });

    form.addEventListener('submit', async (e) => {
  e.preventDefault();
  statusEl.textContent = '正在上傳與生成中…';
  statusEl.className = 'status';

  const fd = new FormData(form);

  try {
    const res = await fetch('/api/create', { method: 'POST', body: fd });

    // ⭐先讀 text，避免不是 JSON 就炸
    const text = await res.text();
    console.log('status:', res.status);
    console.log('response text:', text);

    if (!res.ok) {
      throw new Error(`伺服器回應失敗：${res.status}\n${text.slice(0, 200)}`);
    }

    // ⭐再嘗試把 text 轉 JSON
    const data = JSON.parse(text);

    statusEl.innerHTML = `✅ 已生成：<a href="${data.url}" target="_blank" style="color:inherit;text-decoration:underline">${data.url}</a>`;
    statusEl.classList.add('ok');
  } catch (err) {
    statusEl.textContent = '❌ 生成失敗：' + err.message;
    statusEl.classList.add('error');
  }
});

  </script>
  <script>
  const photoInput = document.querySelector('input[name="photos"]');

  photoInput.addEventListener('change', () => {
    if (photoInput.files.length !== 4) {
      alert("請一次選取「剛好 4 張」照片，會依順序套用。");
      photoInput.value = "";
    }
  });
</script>
<script>
  const aiFillBtn = document.getElementById('aiFillBtn');
  const aiClearBtn = document.getElementById('aiClearBtn');
  const aiStatus = document.getElementById('aiStatus');

  aiClearBtn.addEventListener('click', () => {
    ['ai_q1','ai_q2','ai_q3','ai_style'].forEach(id => document.getElementById(id).value = '');
    aiStatus.textContent = '';
  });

  aiFillBtn.addEventListener('click', async () => {
    aiStatus.className = 'status';
    aiStatus.textContent = 'AI 生成中…';

    const answers = [
      { q: '你們怎麼認識的？', a: document.getElementById('ai_q1').value.trim() },
      { q: '你最喜歡對方的一件小事？', a: document.getElementById('ai_q2').value.trim() },
      { q: '你希望賓客在這天感受到什麼？', a: document.getElementById('ai_q3').value.trim() },
      { q: '口吻（第一人稱）', a: document.getElementById('ai_style').value.trim() },
      { q: '語言', a: document.getElementById('ai_lang').value.trim() },
    ].filter(x => x.a); // 空白就不送

    const payload = { answers };

    try{
      const res = await fetch('/api/ai_prefill', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if(!res.ok || !data.ok) throw new Error(data.error || 'AI 失敗');

      // ✅ 你後端回傳的是 { ok: true, data: {...} }
      const fill = data.data;

      const form = document.getElementById('inviteForm');
      if (fill.cover_subtitle) form.cover_subtitle.value = fill.cover_subtitle;
      if (fill.story_subtitle) form.story_subtitle.value = fill.story_subtitle;
      if (fill.story_p1) form.story_p1.value = fill.story_p1;
      if (fill.story_p2) form.story_p2.value = fill.story_p2;

      // 如果你也想自動填基本欄位，可加這些（有值才覆蓋）
      if (fill.page_title) form.page_title.value = fill.page_title;
      if (fill.couple_title) form.couple_title.value = fill.couple_title;
      if (fill.wedding_date_text) form.wedding_date_text.value = fill.wedding_date_text;
      if (fill.wedding_time_text) form.wedding_time_text.value = fill.wedding_time_text;
      if (fill.venue_name) form.venue_name.value = fill.venue_name;
      if (fill.venue_address) form.venue_address.value = fill.venue_address;
      if (fill.map_url) form.map_url.value = fill.map_url;
      if (fill.rsvp_url) form.rsvp_url.value = fill.rsvp_url;

      // timeline
      if (fill.tl1_time) form.tl1_time.value = fill.tl1_time;
      if (fill.tl1_text) form.tl1_text.value = fill.tl1_text;
      if (fill.tl2_time) form.tl2_time.value = fill.tl2_time;
      if (fill.tl2_text) form.tl2_text.value = fill.tl2_text;
      if (fill.tl3_time) form.tl3_time.value = fill.tl3_time;
      if (fill.tl3_text) form.tl3_text.value = fill.tl3_text;

      aiStatus.textContent = '✅ 已填入表單，你可以再微調。';
      aiStatus.classList.add('ok');
    }catch(err){
      aiStatus.textContent = '❌ ' + err.message;
      aiStatus.classList.add('error');
    }
  });
</script>


</body>
</html>
